---
title: "storytelling"
author: "Fernando Almeida Barbalho"
date: "2026-01-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)

dados_2024_sem_brasil <- readRDS("~/github/labs_microdatasus/dados_2024_sem_brasil.rds")
sintese_sih_1 <- readRDS("~/github/labs_microdatasus/sintese_sih_1.rds")
sintese_sih_2 <- readRDS("~/github/labs_microdatasus/sintese_sih_2.rds")
sintese_sih_3 <- readRDS("~/github/labs_microdatasus/sintese_sih_3.rds")
sintese_sp_2024 <- readRDS("~/github/labs_microdatasus/sintese_sp_2024.rds")

uf_ibge<-
  
tibble(
  uf = c(
    "11","12","13","14","15","16","17",
    "21","22","23","24","25","26","27","28","29",
    "50","51","52","53",
    "31","32","33","35",
    "41","42","43"
  ),
  sigla_uf = c(
    "RO","AC","AM","RR","PA","AP","TO",
    "MA","PI","CE","RN","PB","PE","AL","SE","BA",
    "MS","MT","GO","DF",
    "MG","ES","RJ","SP",
    "PR","SC","RS"
  )
)

```


```{r fig.dpi= 300}



dados_brasil_outros<-
  sintese_sih_1 %>%
  bind_rows(
    sintese_sih_2,
    sintese_sih_3, 
    sintese_sp_2024
  ) %>%
  mutate(nacional = ifelse(nacional == "Brasil","Brasil", "Outros países")) %>%
  summarise(quantidade = sum(quantidade),
            .by = nacional)

total_atendimentos<- sum(dados_brasil_outros$quantidade)


dados_grafico_brasil_outros<-
  dados_brasil_outros %>%
  mutate(proporcao = quantidade/total_atendimentos)

```

```{r}



unique(dados_sp_2024_sem_brasil$nacional)


dados_grafico_ranking_pais<-
dados_2024_sem_brasil %>%
  filter(nacional != "Reservado") %>%
  summarise(quantidade = n(),
            .by =nacional ) %>%
  mutate(nacional = reorder(nacional, quantidade)) %>%
  slice_max(n= 20, order_by = quantidade)
  

 dados_grafico_ranking_pais %>%
   ggplot(aes(x= quantidade, y= nacional)) +
   geom_col() +
   geom_text(aes(label = quantidade), hjust= 0) +
   scale_x_continuous(expand = expansion(mult = c(0.01, 0.1)))
 
####Avaliar a validade dos dados de Ilhas Virgens Britânicas e Gibraltar
 
  
 # dados_2024_sem_brasil %>%
 #   filter(nacional == "Ilhas virgens britanicas") %>%
 #   summarise(quantidade = n(),
 #             .by =c(nacional,  uf_zi) ) %>%
 #   ggplot(aes(x=nacional, y= quantidade)) +
 #   geom_boxplot()
 # 
 #  dados_2024_sem_brasil %>%
 #   filter(nacional == "Portugal") %>%
 #   summarise(quantidade = n(),
 #             .by =c(nacional,  uf_zi) ) %>%
 #   ggplot(aes(x=nacional, y= quantidade)) +
 #   geom_boxplot()
 # 
 # 
 #  dados_2024_sem_brasil %>%
 #   filter(nacional == "Gibraltar") %>%
 #   mutate(uf = str_sub(uf_zi,1,2)) %>%
 #   inner_join(uf_ibge) %>%  
 #   summarise(quantidade = n(),
 #             .by =c(nacional,  sigla_uf) ) %>%
 #   arrange(desc(quantidade))
 #  
 #  dados_2024_sem_brasil %>%
 #   filter(nacional == "Ilhas virgens britanicas") %>%
 #   mutate(uf = str_sub(uf_zi,1,2)) %>%
 #   inner_join(uf_ibge) %>%  
 #   summarise(quantidade = n(),
 #             .by =c(nacional,  sigla_uf) ) %>%
 #   arrange(desc(quantidade))
 # 
 # 
 #  dados_2024_sem_brasil %>%
 #   filter(nacional == "Ilhas virgens britanicas") %>%
 #   mutate(uf = str_sub(uf_zi,1,2)) %>%
 #   inner_join(uf_ibge) %>%  
 #   summarise(quantidade = n(),
 #             .by =c(nacional,  cnes) ) %>%
 #   arrange(desc(quantidade))
 #  
 #    
 #    
 #   ggplot(aes(x=nacional, y= quantidade)) +
 #   geom_boxplot()
  
  
   
```

